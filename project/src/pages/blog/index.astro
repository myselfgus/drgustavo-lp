---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import '../../styles/pages/blog.css';

const entries = await getCollection('blog', ({ data }) => !data.draft);
const posts = entries
  .slice()
  .sort((a, b) => b.data.publishedAt.getTime() - a.data.publishedAt.getTime());

const formatDate = (date: Date) =>
  new Intl.DateTimeFormat('pt-BR', {
    day: '2-digit',
    month: 'short',
    year: 'numeric'
  }).format(date);
---

<BaseLayout
  title="Blog - Dr. Gustavo Mendes e Silva | Artigos sobre Saúde Mental"
  description="Artigos sobre psiquiatria, neurodiversidade, tecnologia clínica e uso ético de IA para re-humanizar o cuidado."
  showDots={false}
>
  <main class="blog">
    <header class="blog__header blog__wrap">
      <h1>Blog</h1>
      <p>Artigos e reflexões para quem vive e cuida da saúde mental.</p>
    </header>

    <section class="blog__wrap" aria-labelledby="lista-artigos">
      <h2 id="lista-artigos" class="blog__section-title">
        Todos os artigos
      </h2>

      {posts.length > 0 ? (
        <ul class="post-feed" role="list">
          {posts.map(post => (
            <li class="post-feed__item">
              <a class="post-feed__link" href={`/blog/${post.slug}`}>
                <time datetime={post.data.publishedAt.toISOString()}>
                  {formatDate(post.data.publishedAt)}
                </time>
                <h3>{post.data.title}</h3>
                <p>{post.data.excerpt}</p>
                {post.data.tags?.length > 0 && (
                  <ul class="post-feed__tags">
                    {post.data.tags.slice(0, 3).map(tag => (
                      <li>#{tag}</li>
                    ))}
                  </ul>
                )}
              </a>
            </li>
          ))}
        </ul>
      ) : (
        <p>Novos artigos em edição. Volte em breve para mais leituras.</p>
      )}
    </section>
  </main>
</BaseLayout>
