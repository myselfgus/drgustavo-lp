---
import '../styles/sections/depoimentos.css';

const depoimentos = [
  {
    texto: '“Ele traduziu meu padrão de pensamento em um plano que finalmente fez sentido para mim e para minha família.”',
    autor: 'Paciente acompanhado desde 2023'
  },
  {
    texto: '“Consultas longas, informes claros e ajustes em tempo real. Senti pela primeira vez que eu comandava o processo.”',
    autor: 'Profissional de tecnologia, 34 anos'
  },
  {
    texto: '“Tive acompanhamento responsável com canabidiol, com ciência e sem promessas fáceis.”',
    autor: 'Paciente com dor crônica, 52 anos'
  }
];
---

<section id="depoimentos" class="depoimentos" aria-labelledby="depoimentos-title">
  <div class="depoimentos__content container">
    <span class="depoimentos__eyebrow" data-animate="fade-right">Quem vive o processo</span>
    <h2 id="depoimentos-title" class="depoimentos__title" data-animate="fade-right">Depoimentos selecionados</h2>

    <div class="depoimentos__grid" data-depoimentos>
      {depoimentos.map((item, index) => (
        <figure
          class={`depoimentos__card${index === 0 ? ' is-highlighted' : ''}`}
          data-depoimento-card
          data-index={index}
        >
          <blockquote>{item.texto}</blockquote>
          <figcaption>{item.autor}</figcaption>
        </figure>
      ))}
    </div>

    <button
      class="depoimentos__next"
      type="button"
      data-scroll-target="para-quem"
      aria-label="Ir para a próxima seção"
      data-animate="fade-up"
    >
      Para quem desenhamos este cuidado ↓
    </button>
  </div>
</section>

<script>
  const depoimentosSection = document.getElementById('depoimentos');
  if (depoimentosSection) {
    const nextButton = depoimentosSection.querySelector('[data-scroll-target]');
    if (nextButton) {
      const targetId = nextButton.getAttribute('data-scroll-target');
      nextButton.addEventListener('click', () => {
        if (!targetId) return;
        document.getElementById(targetId)?.scrollIntoView({ behavior: 'smooth', block: 'start' });
      });
    }

    if (window.matchMedia('(min-width: 768px)').matches) {
      const container = depoimentosSection.querySelector('[data-depoimentos]');
      const cards = container ? Array.from(container.querySelectorAll('[data-depoimento-card]')) : [];
      if (container && cards.length > 1) {
        let activeIndex = 0;
        const delays = [7000, 11000, 8500];
        highlight(activeIndex);
        let timer = window.setTimeout(next, delays[0]);

        function highlight(index: number) {
          cards.forEach((card, i) => {
            card.classList.toggle('is-highlighted', i === index);
          });
          activeIndex = index;
        }

        function next() {
          const nextIndex = (activeIndex + 1) % cards.length;
          highlight(nextIndex);
          timer = window.setTimeout(next, delays[nextIndex % delays.length]);
        }

        container.addEventListener('mouseenter', () => {
          window.clearTimeout(timer);
        });

        container.addEventListener('mouseleave', () => {
          window.clearTimeout(timer);
          timer = window.setTimeout(next, delays[(activeIndex + 1) % delays.length]);
        });
      }
    }
  }
</script>
